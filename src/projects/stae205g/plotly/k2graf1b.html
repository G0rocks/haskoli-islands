<div id="plotly_graf1b"></div>
<script>
    function drawGraf1b() {
        // Þurfum námundunarfall til að forðast floating point klúður á eftir
        function round(num, prec = 4) {
            return Math.round((num + Number.EPSILON) * (10 ** prec)) / (10 ** prec)
        }

        // z-hnitið sem fall af x og y
        function fall(x, y) {
            return Math.sqrt(1 - x * x - y * y);
        }

        // Plotly stillingar (layout og config)
        let layout = {
            scene1: {
                xaxis: {
                    gridcolor: '#7d7d7d',
                    showspikes: false,
                    showbackground: true,
                    backgroundcolor: 'rgba(0, 0, 0, 0)',
                    range: [-0.7, 0.7],
                    tickmode: 'linear',
                    tick0: 0,
                    dtick: 0.25,
                    showline: true,
                    linewidth: 3,
                    ticks: 'outside',
                    tickwidth: 2,
                    tickcolor: 'black',
                    ticklen: 10,
                },
                yaxis: {
                    gridcolor: '#7d7d7d',
                    showspikes: false,
                    showbackground: true,
                    backgroundcolor: 'rgba(0, 0, 0, 0)',
                    range: [-0.7, 0.7],
                    tickmode: 'linear',
                    tick0: 0,
                    dtick: 0.25,
                    linewidth: 3,
                    ticks: 'outside',
                    tickwidth: 2,
                    tickcolor: 'black',
                    ticklen: 10,
                },
                zaxis: {
                    gridcolor: '#7d7d7d',
                    showspikes: false,
                    showbackground: true,
                    backgroundcolor: 'rgba(0, 0, 0, 0)',
                    range: [0.69, 1.0],
                    tickmode: 'linear',
                    tick0: 1,
                    dtick: 0.05,
                    linewidth: 3,
                    ticks: 'outside',
                    tickwidth: 2,
                    tickcolor: 'black',
                    ticklen: 10,
                    tickson: 'boundaries',
                    hoverformat: '.2f',
                },
                aspectratio: {
                    x: 1,
                    y: 1,
                    z: .75,
                },
                hovermode: 'z',
                camera: {
                    center: {
                        x: .2,
                        y: .3,
                        z: -.05,
                    },
                    eye: {
                        x: 1.3,
                        y: 1.5,
                        z: .4,
                    }
                },
                annotations: [
                    {
                        x: 0.25,
                        y: -0.187,
                        z: 0.69,
                        ax: -50,
                        ay: 10,
                        xanchor: 'right',
                        // xshift: 1,
                        // yshift: 1,
                        text: 'Jafnhæðarlínan f(x,y) = 0.95',
                        bordercolor: '#000000',
                        borderwidth: 1,
                        borderpad: 3,
                        bgcolor: '#f2f1e6',
                    },
                    {
                        x: 0.05,
                        y: 0.433,
                        z: 0.69,
                        ax: 40,
                        ay: 40,
                        xanchor: 'left',
                        xshift: 1,
                        yshift: 1,
                        text: 'Jafnhæðarlínan f(x,y) = 0.90',
                        bordercolor: '#000000',
                        borderwidth: 1,
                        borderpad: 3,
                        bgcolor: '#f2f1e6',
                    },
                    {
                        x: -0.35,
                        y: 0.394,
                        z: 0.69,
                        ax: 50,
                        ay: -20,
                        xanchor: 'left',
                        xshift: 1,
                        yshift: 1,
                        text: 'Jafnhæðarlínan f(x,y) = 0.85',
                        bordercolor: '#000000',
                        borderwidth: 1,
                        borderpad: 3,
                        bgcolor: '#f2f1e6',
                    },

                ]
            },

            xaxis2: {
                gridcolor: '#7d7d7d',
                range: [-0.7, 0.7],
                tickmode: 'linear',
                tick0: 0,
                dtick: 0.25,
                tickcolor: 'black',
            },
            yaxis2: {
                gridcolor: '#7d7d7d',
                range: [-0.7, 0.7],
                tickmode: 'linear',
                tick0: 0,
                dtick: 0.25,
                tickcolor: 'black',
            },

            grid: {
                rows: 2,
                columns: 1,
                pattern: 'independent',
            },
            showlegend: false,
            width: 700,
            height: 1000,
            // margin: {
            //     l: 0,
            //     r: 0,
            //     t: 0,
            //     b: 0,
            // },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            hoverlabel: {
                bgcolor: '#fffce8',
                bordercolor: '#101010',
                font: {
                    color: 'black',
                    size: 18,
                },
            },
        };
        let config = {
            'displayModeBar': false,
        }

        // Skilgreinum data
        let steps = 32;
        let axisMin = -0.5;
        let axisMax = 0.5;
        let axisStep = round((axisMax - axisMin) / steps);
        let traces = []
        let x = []
        let y = []
        let z = []
        let jhl1_x = []
        let jhl1_y = []
        let jhl2_x = []
        let jhl2_y = []
        let jhl3_x = []
        let jhl3_y = []
        for (let i = axisMin; i <= axisMax; i += axisStep) {
            x_row = []
            y_row = []
            z_row = []
            for (let j = axisMin; j <= axisMax; j += axisStep) {
                x_row.push(round(i))
                y_row.push(round(j))
                z_row.push(fall(i, j))
            }
            x.push(x_row)
            y.push(y_row)
            z.push(z_row)
        }
        for (let t = 0; t <= 6.3; t += 0.1) {
            jhl1_x.push(0.25 * Math.cos(t))
            jhl1_y.push(0.25 * Math.sin(t))
            jhl2_x.push(0.45 * Math.cos(t))
            jhl2_y.push(0.45 * Math.sin(t))
            // NEMA FARI YFIR 
            jhl3_x.push(0.60 * Math.cos(t))
            jhl3_y.push(0.60 * Math.sin(t))
        }
        let data = {
            x: x,
            y: y,
            z: z,
            xaxis: 'x1',
            yaxis: 'y1',
            type: 'surface',
            showscale: false,
            colorscale: [[0, '#636363'], [1, '#636363']],
            hidesurface: false,
            opacity: 0.25,
            hovertemplate: 'f(x,y) = %{z:.2f}<extra></extra>',
            contours: {
                x: {
                    show: false,
                    width: 1, // ATH webGL: óáreiðanlegt að breyta
                    usecolormap: true,
                    highlight: false,
                    color: '#d1d1d1',
                    start: axisMin,
                    end: axisMax,
                    size: axisStep,
                },
                y: {
                    show: false,
                    width: 1, // ATH webGL: óáreiðanlegt að breyta
                    usecolormap: true,
                    highlight: false,
                    color: '#d1d1d1',
                    start: axisMin,
                    end: axisMax,
                    size: axisStep,
                },
                z: {
                    show: false,
                    width: 1, // ATH webGL: óáreiðanlegt að breyta
                    color: '#000000',
                    highlight: true,
                    highlightcolor: '#000000',
                    start: 0.85,
                    end: 1.0,
                    size: 0.05,
                    project: {
                        z: true,
                    },
                }
            },
        };
        let data2 = {
            x: x,
            y: y,
            z: z,
            xaxis: 'x',
            yaxis: 'y',
            type: 'surface',
            showscale: false,
            colorscale: [[0, '#337db5'], [0.3, '#337db5'], [0.4, '#48b533'], [0.6, '#48b533'], [0.7, '#de4028'], [1, '#de4028']],
            hidesurface: true,
            hovertemplate: 'f(x,y) = %{z:.2f}<extra></extra>',
            contours: {
                x: {
                    show: false,
                    highlight: false,
                },
                y: {
                    show: false,
                    highlight: false,
                },
                z: {
                    show: true,
                    width: 1, // ATH webGL: óáreiðanlegt að breyta
                    usecolormap: true,
                    highlight: true,
                    highlightcolor: '#000000',
                    start: 0.83,
                    end: 0.98,
                    size: 0.07,
                    project: {
                        z: true,
                    },
                }
            },
        };
        let data_jhl1 = {
            x: jhl1_x,
            y: jhl1_y,
            xaxis: 'x2',
            yaxis: 'y2',
            mode: 'lines',
            line: {
                color: 'red'
            },
            type: 'scatter',
        }
        let data_jhl2 = {
            x: jhl2_x,
            y: jhl2_y,
            xaxis: 'x2',
            yaxis: 'y2',
            mode: 'lines',
            line: {
                color: 'green'
            },
            type: 'scatter',
        }
        let data_jhl3 = {
            x: jhl3_x,
            y: jhl3_y,
            xaxis: 'x2',
            yaxis: 'y2',
            mode: 'lines',
            line: {
                color: 'blue'
            },
            type: 'scatter',
        }

        traces = [data, data2, data_jhl1, data_jhl2, data_jhl3];

        Plotly.newPlot(document.getElementById('plotly_graf1b'), traces, layout, config);
    }
    drawGraf1b()
</script>
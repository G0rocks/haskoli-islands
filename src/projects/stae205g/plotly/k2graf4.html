<div id="plotly_graf4"></div>
<script>
    function drawGraf4() {
        // Þurfum námundunarfall til að forðast floating point klúður á eftir
        function round(num, prec = 4) {
            return Math.round((num + Number.EPSILON) * (10 ** prec)) / (10 ** prec)
        }

        // z-hnitið sem fall af x og y
        function fall(x, y) {
            return 9 - x * x - y * y;
        }

        // Plotly stillingar (layout og config)
        let layout = {
            scene: {
                xaxis: {
                    gridcolor: '#7d7d7d',
                    showspikes: false,
                    showbackground: true,
                    backgroundcolor: 'rgba(0, 0, 0, 0)',
                    range: [-2, 2],
                    tickmode: 'array',
                    tickvals: [-2, -1, 0, 1, 2],
                    showline: true,
                    linewidth: 3,
                    ticks: 'outside',
                    tickwidth: 2,
                    tickcolor: 'black',
                    ticklen: 10,
                },
                yaxis: {
                    gridcolor: '#7d7d7d',
                    showspikes: false,
                    showbackground: true,
                    backgroundcolor: 'rgba(0, 0, 0, 0)',
                    range: [-2, 2],
                    tickmode: 'array',
                    tickvals: [-1, 0, 1, 2],
                    // tickmode: 'linear',
                    // tick0: 0,
                    // dtick: 0.25,
                    linewidth: 3,
                    ticks: 'outside',
                    tickwidth: 2,
                    tickcolor: 'black',
                    ticklen: 10,
                },
                zaxis: {
                    gridcolor: '#7d7d7d',
                    showspikes: false,
                    showbackground: true,
                    backgroundcolor: 'rgba(0, 0, 0, 0)',
                    range: [1, 10],
                    tickmode: 'linear',
                    tick0: 10,
                    dtick: 2,
                    linewidth: 3,
                    ticks: 'outside',
                    tickwidth: 2,
                    tickcolor: 'black',
                    ticklen: 10,
                    tickson: 'boundaries',
                },
                aspectratio: {
                    x: 1,
                    y: 1,
                    z: .75,
                },
                hovermode: false,
                camera: {
                    center: {
                        x: .3,
                        y: .3,
                        z: -.05,
                    },
                    eye: {
                        x: 1.3,
                        y: 1.5,
                        z: .4,
                    }
                },
                annotations: [
                    {
                        showarrow: false,
                        x: 0.3,
                        y: 1,
                        z: -2 * 0.3 + 9,
                        xshift: 12,
                        yshift: 6,
                        xanchor: 'left',
                        text: "$\\boldsymbol{T}_1$",
                        textangle: 0,
                        font: {
                            color: "black",
                            size: 16,
                        },
                    },
                    {
                        showarrow: false,
                        x: 1,
                        y: 0.3,
                        z: -2 * 0.3 + 9,
                        xshift: -12,
                        yshift: 6,
                        xanchor: 'right',
                        text: "$\\boldsymbol{T}_2$",
                        textangle: 0,
                        font: {
                            color: "black",
                            size: 16,
                        },
                    },
                ],
            },
            showlegend: false,
            width: 700,
            height: 500,
            margin: {
                l: 0,
                r: 0,
                t: 0,
                b: 0,
            },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
        };
        let config = {
            'displayModeBar': false,
        }

        // Skilgreinum data
        let steps = 32;
        let axisMin = -2;
        let axisMax = 2;
        let axisStep = round((axisMax - axisMin) / steps);
        let traces = []
        let x = []
        let y = []
        let z = []
        x_sletta1 = []
        y_sletta1 = []
        z_sletta1 = []
        x_sletta2 = []
        y_sletta2 = []
        z_sletta2 = []
        x_lina1 = []
        y_lina1 = []
        z_lina1 = []
        x_lina2 = []
        y_lina2 = []
        z_lina2 = []
        x_vigur1 = []
        y_vigur1 = []
        z_vigur1 = []
        x_vigur2 = []
        y_vigur2 = []
        z_vigur2 = []
        for (let i = axisMin; i <= axisMax; i += axisStep) {
            x_row = []
            y_row = []
            z_row = []
            for (let j = axisMin; j <= axisMax; j += axisStep) {
                x_row.push(round(i))
                y_row.push(round(j))
                z_row.push(fall(i, j))
            }
            x.push(x_row)
            y.push(y_row)
            z.push(z_row)
        }
        for (let i = axisMin; i <= axisMax; i += 1) {
            x_sletta_row1 = []
            y_sletta_row1 = []
            z_sletta_row1 = []
            x_sletta_row2 = []
            y_sletta_row2 = []
            z_sletta_row2 = []
            for (let k = 1; k <= 9; k += 1) {
                x_sletta_row1.push(1)
                y_sletta_row1.push(round(i))
                z_sletta_row1.push(round(k))
                x_sletta_row2.push(round(i))
                y_sletta_row2.push(1)
                z_sletta_row2.push(round(k))
            }
            x_sletta1.push(x_sletta_row1)
            y_sletta1.push(y_sletta_row1)
            z_sletta1.push(z_sletta_row1)
            x_sletta2.push(x_sletta_row2)
            y_sletta2.push(y_sletta_row2)
            z_sletta2.push(z_sletta_row2)
        }
        for (let i = 0; i <= axisMax; i += axisStep) {
            x_lina1.push(1)
            y_lina1.push(i)
            z_lina1.push(-2 * i + 9)
            x_lina2.push(i)
            y_lina2.push(1)
            z_lina2.push(-2 * i + 9)
        }
        for (let i = 1; i >= 0.1; i -= 0.45) {
            x_vigur1.push(1)
            y_vigur1.push(i)
            z_vigur1.push(-2 * i + 9)
            x_vigur2.push(i)
            y_vigur2.push(1)
            z_vigur2.push(-2 * i + 9)
        }
        let data = {
            x: x,
            y: y,
            z: z,
            type: 'surface',
            showscale: false,
            colorscale: 'Rainbow',
            hidesurface: false,
            contours: {
                x: {
                    show: true,
                    width: 1, // ATH webGL: óáreiðanlegt að breyta
                    color: 'black',
                    highlight: false,
                    color: '#212121',
                    start: axisMin,
                    end: axisMax,
                    size: axisStep,
                },
                y: {
                    show: true,
                    width: 1, // ATH webGL: óáreiðanlegt að breyta
                    color: 'black',
                    highlight: false,
                    color: '#212121',
                    start: axisMin,
                    end: axisMax,
                    size: axisStep,
                },
                z: {
                    show: false,
                    highlight: false,
                }
            },
        };
        let data_sletta1 = {
            x: x_sletta1,
            y: y_sletta1,
            z: z_sletta1,
            type: 'surface',
            showscale: false,
            colorscale: [[0, '#EEEEEE'], [1, '#EEEEEE']],
            hidesurface: false,
            opacity: 0.6,
            contours: {
                x: {
                    show: false,
                    highlight: false,
                },
                y: {
                    show: false,
                    highlight: false,
                },
                z: {
                    show: false,
                    highlight: false,
                }
            },
        };
        let data_sletta2 = {
            x: x_sletta2,
            y: y_sletta2,
            z: z_sletta2,
            type: 'surface',
            showscale: false,
            colorscale: [[0, '#EEEEEE'], [1, '#EEEEEE']],
            hidesurface: false,
            opacity: 0.6,
            contours: {
                x: {
                    show: false,
                    highlight: false,
                },
                y: {
                    show: false,
                    highlight: false,
                },
                z: {
                    show: false,
                    highlight: false,
                }
            },
        };
        let data_lina1 = {
            x: x_lina1,
            y: y_lina1,
            z: z_lina1,
            type: 'scatter3d',
            mode: 'lines',
            line: {
                width: 3,
                color: '#265694',
            },
        }
        let data_lina2 = {
            x: x_lina2,
            y: y_lina2,
            z: z_lina2,
            type: 'scatter3d',
            mode: 'lines',
            line: {
                width: 3,
                color: '#265694',
            },
        }
        let data_vigur1 = {
            x: x_vigur1,
            y: y_vigur1,
            z: z_vigur1,
            type: 'scatter3d',
            mode: 'lines',
            line: {
                width: 12,
                color: '#000000',
            },
        }
        let data_vigur2 = {
            x: x_vigur2,
            y: y_vigur2,
            z: z_vigur2,
            type: 'scatter3d',
            mode: 'lines',
            line: {
                width: 12,
                color: '#000000',
            },
        }
        let data_viguroddar = {
            x: [0, 1],
            y: [1, 0],
            z: [9, 9],
            u: [-1, 0],
            v: [0, -1],
            w: [(9) - (-2 * 1 + 9), (9) - (-2 * 1 + 9)],
            type: 'cone',
            showscale: false,
            colorscale: [[0, '#000000'], [1, '#000000']],
            sizeref: .3,
            anchor: 'tip',
        }
        let data_skurdpunktur = {
            x: [1],
            y: [1],
            z: [7],
            type: 'scatter3d',
            mode: 'markers',
            marker: {
                size: 6,
                color: 'black'
            },
        }

        traces = [data, data_sletta1, data_sletta2, data_lina1, data_lina2, data_vigur1, data_vigur2, data_viguroddar]

        Plotly.newPlot(document.getElementById('plotly_graf4'), traces, layout, config);
    }
    drawGraf4()
</script>